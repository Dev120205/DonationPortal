{"version":3,"file":"node-build.mjs","sources":["../../server/routes/demo.ts","../../server/routes/auth.ts","../../server/utils/csvUtils.ts","../../server/routes/donations.ts","../../server/routes/requests.ts","../../server/routes/matching.ts","../../server/routes/activities.ts","../../server/routes/public.ts","../../server/routes/seed.ts","../../server/index.ts","../../server/node-build.ts"],"sourcesContent":["import { RequestHandler } from \"express\";\r\nimport { DemoResponse } from \"@shared/api\";\r\n\r\nexport const handleDemo: RequestHandler = (req, res) => {\r\n  const response: DemoResponse = {\r\n    message: \"Hello from Express server\",\r\n  };\r\n  res.status(200).json(response);\r\n};\r\n","import { RequestHandler } from \"express\";\r\nimport { RegisterRequest, RegisterResponse, LoginRequest, LoginResponse, User, UserRole } from \"@shared/api\";\r\nimport crypto from \"crypto\";\r\n\r\n// Simple in-memory storage for demo purposes\r\n// In a real application, you would use a proper database\r\ninterface StoredUser {\r\n  id: string;\r\n  name: string;\r\n  email: string;\r\n  password: string; // In production, this should be hashed\r\n  role: UserRole;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\n// Initialize with some default users for testing\r\nconst users: StoredUser[] = [\r\n  {\r\n    id: 'admin1',\r\n    name: 'Admin User',\r\n    email: 'admin@example.com',\r\n    password: 'admin123',\r\n    role: 'admin',\r\n    createdAt: new Date().toISOString(),\r\n    updatedAt: new Date().toISOString()\r\n  },\r\n  {\r\n    id: 'donor1',\r\n    name: 'Donor User',\r\n    email: 'donor@example.com',\r\n    password: 'donor123',\r\n    role: 'donor',\r\n    createdAt: new Date().toISOString(),\r\n    updatedAt: new Date().toISOString()\r\n  },\r\n  {\r\n    id: 'receiver1',\r\n    name: 'Receiver User',\r\n    email: 'receiver@example.com',\r\n    password: 'receiver123',\r\n    role: 'receiver',\r\n    createdAt: new Date().toISOString(),\r\n    updatedAt: new Date().toISOString()\r\n  }\r\n];\r\n\r\n// Simple JWT-like token generation for demo\r\nconst generateToken = (userId: string, role: UserRole): string => {\r\n  const payload = { userId, role, exp: Date.now() + (24 * 60 * 60 * 1000) }; // 24 hours\r\n  return Buffer.from(JSON.stringify(payload)).toString('base64');\r\n};\r\n\r\nconst validateToken = (token: string): { userId: string; role: UserRole } | null => {\r\n  try {\r\n    const payload = JSON.parse(Buffer.from(token, 'base64').toString());\r\n    if (payload.exp < Date.now()) {\r\n      return null; // Token expired\r\n    }\r\n    return { userId: payload.userId, role: payload.role };\r\n  } catch {\r\n    return null;\r\n  }\r\n};\r\n\r\n// Helper function to find user by email\r\nconst findUserByEmail = (email: string): StoredUser | undefined => {\r\n  return users.find(user => user.email.toLowerCase() === email.toLowerCase());\r\n};\r\n\r\n// Helper function to find user by id\r\nconst findUserById = (id: string): StoredUser | undefined => {\r\n  return users.find(user => user.id === id);\r\n};\r\n\r\n// Register endpoint\r\nexport const handleRegister: RequestHandler = (req, res) => {\r\n  try {\r\n    const { name, email, password, role }: RegisterRequest = req.body;\r\n\r\n    // Validation\r\n    if (!name || !email || !password || !role) {\r\n      const response: RegisterResponse = {\r\n        success: false,\r\n        message: \"All fields are required.\"\r\n      };\r\n      return res.status(400).json(response);\r\n    }\r\n\r\n    if (!['donor', 'receiver', 'admin'].includes(role)) {\r\n      const response: RegisterResponse = {\r\n        success: false,\r\n        message: \"Invalid role specified.\"\r\n      };\r\n      return res.status(400).json(response);\r\n    }\r\n\r\n    // Check if user already exists\r\n    if (findUserByEmail(email)) {\r\n      const response: RegisterResponse = {\r\n        success: false,\r\n        message: \"User with this email already exists.\"\r\n      };\r\n      return res.status(409).json(response);\r\n    }\r\n\r\n    // Create new user\r\n    const userId = crypto.randomUUID();\r\n    const now = new Date().toISOString();\r\n    \r\n    const newUser: StoredUser = {\r\n      id: userId,\r\n      name,\r\n      email: email.toLowerCase(),\r\n      password, // In production, hash this password\r\n      role,\r\n      createdAt: now,\r\n      updatedAt: now\r\n    };\r\n\r\n    users.push(newUser);\r\n\r\n    // Generate token\r\n    const token = generateToken(userId, role);\r\n\r\n    // Return user data without password\r\n    const userResponse: Omit<User, 'createdAt' | 'updatedAt'> = {\r\n      id: newUser.id,\r\n      name: newUser.name,\r\n      email: newUser.email,\r\n      role: newUser.role\r\n    };\r\n\r\n    const response: RegisterResponse = {\r\n      success: true,\r\n      message: \"Registration successful!\",\r\n      user: userResponse,\r\n      token\r\n    };\r\n\r\n    res.status(201).json(response);\r\n  } catch (error) {\r\n    console.error(\"Registration error:\", error);\r\n    const response: RegisterResponse = {\r\n      success: false,\r\n      message: \"Internal server error.\"\r\n    };\r\n    res.status(500).json(response);\r\n  }\r\n};\r\n\r\n// Login endpoint\r\nexport const handleLogin: RequestHandler = (req, res) => {\r\n  try {\r\n    const { email, password }: LoginRequest = req.body;\r\n\r\n    // Validation\r\n    if (!email || !password) {\r\n      const response: LoginResponse = {\r\n        success: false,\r\n        message: \"Email and password are required.\"\r\n      };\r\n      return res.status(400).json(response);\r\n    }\r\n\r\n    // Find user\r\n    const user = findUserByEmail(email);\r\n    if (!user) {\r\n      const response: LoginResponse = {\r\n        success: false,\r\n        message: \"Invalid email or password.\"\r\n      };\r\n      return res.status(401).json(response);\r\n    }\r\n\r\n    // Check password (in production, use proper password hashing)\r\n    if (user.password !== password) {\r\n      const response: LoginResponse = {\r\n        success: false,\r\n        message: \"Invalid email or password.\"\r\n      };\r\n      return res.status(401).json(response);\r\n    }\r\n\r\n    // Generate token\r\n    const token = generateToken(user.id, user.role);\r\n\r\n    // Return user data without password\r\n    const userResponse: Omit<User, 'createdAt' | 'updatedAt'> = {\r\n      id: user.id,\r\n      name: user.name,\r\n      email: user.email,\r\n      role: user.role\r\n    };\r\n\r\n    const response: LoginResponse = {\r\n      success: true,\r\n      message: \"Login successful!\",\r\n      user: userResponse,\r\n      token\r\n    };\r\n\r\n    res.json(response);\r\n  } catch (error) {\r\n    console.error(\"Login error:\", error);\r\n    const response: LoginResponse = {\r\n      success: false,\r\n      message: \"Internal server error.\"\r\n    };\r\n    res.status(500).json(response);\r\n  }\r\n};\r\n\r\n// Middleware for authentication\r\nexport const authenticateToken: RequestHandler = (req, res, next) => {\r\n  const authHeader = req.headers['authorization'];\r\n  const token = authHeader && authHeader.split(' ')[1]; // Bearer TOKEN\r\n\r\n  if (!token) {\r\n    return res.status(401).json({ success: false, message: \"Access token required.\" });\r\n  }\r\n\r\n  const decoded = validateToken(token);\r\n  if (!decoded) {\r\n    return res.status(403).json({ success: false, message: \"Invalid or expired token.\" });\r\n  }\r\n\r\n  // Add user info to request object\r\n  (req as any).user = { id: decoded.userId, role: decoded.role };\r\n  next();\r\n};\r\n\r\n// Middleware for role-based access control\r\nexport const requireRole = (allowedRoles: UserRole[]) => {\r\n  return (req: any, res: any, next: any) => {\r\n    if (!req.user) {\r\n      return res.status(401).json({ success: false, message: \"Authentication required.\" });\r\n    }\r\n\r\n    if (!allowedRoles.includes(req.user.role)) {\r\n      return res.status(403).json({ success: false, message: \"Insufficient permissions.\" });\r\n    }\r\n\r\n    next();\r\n  };\r\n};\r\n\r\n// Export utilities for other routes\r\nexport { validateToken, findUserById, users };\r\n","import fs from 'fs';\r\nimport path from 'path';\r\n\r\n// CSV file paths\r\nconst DATA_DIR = path.join(process.cwd(), 'data');\r\nconst DONATIONS_CSV = path.join(DATA_DIR, 'donations.csv');\r\nconst REQUESTS_CSV = path.join(DATA_DIR, 'requests.csv');\r\n\r\n// Ensure data directory exists\r\nexport function ensureDataDirectory() {\r\n  if (!fs.existsSync(DATA_DIR)) {\r\n    fs.mkdirSync(DATA_DIR, { recursive: true });\r\n  }\r\n}\r\n\r\n// Initialize CSV files with headers if they don't exist\r\nexport function initializeCSVFiles() {\r\n  ensureDataDirectory();\r\n  \r\n  // Initialize donations.csv\r\n  if (!fs.existsSync(DONATIONS_CSV)) {\r\n    const donationsHeader = 'id,donorId,donorName,donorEmail,itemName,category,description,quantity,photoUrl,status,createdAt,updatedAt\\n';\r\n    fs.writeFileSync(DONATIONS_CSV, donationsHeader);\r\n  }\r\n  \r\n  // Initialize requests.csv\r\n  if (!fs.existsSync(REQUESTS_CSV)) {\r\n    const requestsHeader = 'id,receiverId,receiverName,receiverEmail,itemNeeded,category,description,quantity,urgency,status,createdAt,updatedAt\\n';\r\n    fs.writeFileSync(REQUESTS_CSV, requestsHeader);\r\n  }\r\n}\r\n\r\n// Generate unique ID\r\nexport function generateId(): string {\r\n  return Date.now().toString() + Math.random().toString(36).substr(2, 9);\r\n}\r\n\r\n// Convert object to CSV row\r\nfunction objectToCSVRow(obj: any): string {\r\n  const values = Object.values(obj).map(value => {\r\n    if (value === null || value === undefined) return '';\r\n    const stringValue = String(value);\r\n    // Escape quotes and wrap in quotes if contains comma, quote, or newline\r\n    if (stringValue.includes(',') || stringValue.includes('\"') || stringValue.includes('\\n')) {\r\n      return `\"${stringValue.replace(/\"/g, '\"\"')}\"`;\r\n    }\r\n    return stringValue;\r\n  });\r\n  return values.join(',') + '\\n';\r\n}\r\n\r\n// Convert CSV row to object\r\nfunction csvRowToObject(row: string, headers: string[]): any {\r\n  const values: string[] = [];\r\n  let current = '';\r\n  let inQuotes = false;\r\n  let i = 0;\r\n  \r\n  while (i < row.length) {\r\n    const char = row[i];\r\n    \r\n    if (char === '\"' && !inQuotes) {\r\n      inQuotes = true;\r\n    } else if (char === '\"' && inQuotes) {\r\n      if (row[i + 1] === '\"') {\r\n        current += '\"';\r\n        i++; // Skip next quote\r\n      } else {\r\n        inQuotes = false;\r\n      }\r\n    } else if (char === ',' && !inQuotes) {\r\n      values.push(current);\r\n      current = '';\r\n    } else {\r\n      current += char;\r\n    }\r\n    i++;\r\n  }\r\n  values.push(current); // Add last value\r\n  \r\n  const obj: any = {};\r\n  headers.forEach((header, index) => {\r\n    obj[header] = values[index] || '';\r\n  });\r\n  \r\n  return obj;\r\n}\r\n\r\n// Save donation to CSV\r\nexport interface DonationCSV {\r\n  id: string;\r\n  donorId: string;\r\n  donorName: string;\r\n  donorEmail: string;\r\n  itemName: string;\r\n  category: string;\r\n  description: string;\r\n  quantity: number;\r\n  photoUrl: string;\r\n  status: string;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\nexport function saveDonationToCSV(donation: DonationCSV): void {\r\n  initializeCSVFiles();\r\n  const csvRow = objectToCSVRow(donation);\r\n  fs.appendFileSync(DONATIONS_CSV, csvRow);\r\n}\r\n\r\n// Save request to CSV\r\nexport interface RequestCSV {\r\n  id: string;\r\n  receiverId: string;\r\n  receiverName: string;\r\n  receiverEmail: string;\r\n  itemNeeded: string;\r\n  category: string;\r\n  description: string;\r\n  quantity: number;\r\n  urgency: string;\r\n  status: string;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\nexport function saveRequestToCSV(request: RequestCSV): void {\r\n  initializeCSVFiles();\r\n  const csvRow = objectToCSVRow(request);\r\n  fs.appendFileSync(REQUESTS_CSV, csvRow);\r\n}\r\n\r\n// Read all donations from CSV\r\nexport function readDonationsFromCSV(): DonationCSV[] {\r\n  initializeCSVFiles();\r\n  \r\n  if (!fs.existsSync(DONATIONS_CSV)) {\r\n    return [];\r\n  }\r\n  \r\n  const csvContent = fs.readFileSync(DONATIONS_CSV, 'utf-8');\r\n  const lines = csvContent.trim().split('\\n');\r\n  \r\n  if (lines.length <= 1) {\r\n    return []; // Only header or empty file\r\n  }\r\n  \r\n  const headers = lines[0].split(',');\r\n  const donations: DonationCSV[] = [];\r\n  \r\n  for (let i = 1; i < lines.length; i++) {\r\n    if (lines[i].trim()) {\r\n      try {\r\n        const donation = csvRowToObject(lines[i], headers) as DonationCSV;\r\n        donation.quantity = parseInt(donation.quantity.toString()) || 0;\r\n        donations.push(donation);\r\n      } catch (error) {\r\n        console.error('Error parsing donation row:', lines[i], error);\r\n      }\r\n    }\r\n  }\r\n  \r\n  return donations;\r\n}\r\n\r\n// Read all requests from CSV\r\nexport function readRequestsFromCSV(): RequestCSV[] {\r\n  initializeCSVFiles();\r\n  \r\n  if (!fs.existsSync(REQUESTS_CSV)) {\r\n    return [];\r\n  }\r\n  \r\n  const csvContent = fs.readFileSync(REQUESTS_CSV, 'utf-8');\r\n  const lines = csvContent.trim().split('\\n');\r\n  \r\n  if (lines.length <= 1) {\r\n    return []; // Only header or empty file\r\n  }\r\n  \r\n  const headers = lines[0].split(',');\r\n  const requests: RequestCSV[] = [];\r\n  \r\n  for (let i = 1; i < lines.length; i++) {\r\n    if (lines[i].trim()) {\r\n      try {\r\n        const request = csvRowToObject(lines[i], headers) as RequestCSV;\r\n        request.quantity = parseInt(request.quantity.toString()) || 0;\r\n        requests.push(request);\r\n      } catch (error) {\r\n        console.error('Error parsing request row:', lines[i], error);\r\n      }\r\n    }\r\n  }\r\n  \r\n  return requests;\r\n}\r\n\r\n// Update donation in CSV\r\nexport function updateDonationInCSV(donationId: string, updates: Partial<DonationCSV>): boolean {\r\n  const donations = readDonationsFromCSV();\r\n  const index = donations.findIndex(d => d.id === donationId);\r\n  \r\n  if (index === -1) {\r\n    return false;\r\n  }\r\n  \r\n  donations[index] = { ...donations[index], ...updates, updatedAt: new Date().toISOString() };\r\n  \r\n  // Rewrite entire file\r\n  initializeCSVFiles();\r\n  const header = 'id,donorId,donorName,donorEmail,itemName,category,description,quantity,photoUrl,status,createdAt,updatedAt\\n';\r\n  let csvContent = header;\r\n  \r\n  donations.forEach(donation => {\r\n    csvContent += objectToCSVRow(donation);\r\n  });\r\n  \r\n  fs.writeFileSync(DONATIONS_CSV, csvContent);\r\n  return true;\r\n}\r\n\r\n// Update request in CSV\r\nexport function updateRequestInCSV(requestId: string, updates: Partial<RequestCSV>): boolean {\r\n  const requests = readRequestsFromCSV();\r\n  const index = requests.findIndex(r => r.id === requestId);\r\n  \r\n  if (index === -1) {\r\n    return false;\r\n  }\r\n  \r\n  requests[index] = { ...requests[index], ...updates, updatedAt: new Date().toISOString() };\r\n  \r\n  // Rewrite entire file\r\n  initializeCSVFiles();\r\n  const header = 'id,receiverId,receiverName,receiverEmail,itemNeeded,category,description,quantity,urgency,status,createdAt,updatedAt\\n';\r\n  let csvContent = header;\r\n  \r\n  requests.forEach(request => {\r\n    csvContent += objectToCSVRow(request);\r\n  });\r\n  \r\n  fs.writeFileSync(REQUESTS_CSV, csvContent);\r\n  return true;\r\n}\r\n\r\n// Delete donation from CSV\r\nexport function deleteDonationFromCSV(donationId: string): boolean {\r\n  const donations = readDonationsFromCSV();\r\n  const filteredDonations = donations.filter(d => d.id !== donationId);\r\n  \r\n  if (filteredDonations.length === donations.length) {\r\n    return false; // Not found\r\n  }\r\n  \r\n  // Rewrite entire file\r\n  initializeCSVFiles();\r\n  const header = 'id,donorId,donorName,donorEmail,itemName,category,description,quantity,photoUrl,status,createdAt,updatedAt\\n';\r\n  let csvContent = header;\r\n  \r\n  filteredDonations.forEach(donation => {\r\n    csvContent += objectToCSVRow(donation);\r\n  });\r\n  \r\n  fs.writeFileSync(DONATIONS_CSV, csvContent);\r\n  return true;\r\n}\r\n\r\n// Delete request from CSV\r\nexport function deleteRequestFromCSV(requestId: string): boolean {\r\n  const requests = readRequestsFromCSV();\r\n  const filteredRequests = requests.filter(r => r.id !== requestId);\r\n  \r\n  if (filteredRequests.length === requests.length) {\r\n    return false; // Not found\r\n  }\r\n  \r\n  // Rewrite entire file\r\n  initializeCSVFiles();\r\n  const header = 'id,receiverId,receiverName,receiverEmail,itemNeeded,category,description,quantity,urgency,status,createdAt,updatedAt\\n';\r\n  let csvContent = header;\r\n  \r\n  filteredRequests.forEach(request => {\r\n    csvContent += objectToCSVRow(request);\r\n  });\r\n  \r\n  fs.writeFileSync(REQUESTS_CSV, csvContent);\r\n  return true;\r\n}\r\n","import { RequestHandler } from \"express\";\r\nimport { CreateDonationRequest, CreateDonationResponse, Donation, AdminDonationsResponse, ApprovalResponse, ItemCategory } from \"@shared/api\";\r\nimport { findUserById } from \"./auth\";\r\nimport { \r\n  saveDonationToCSV, \r\n  readDonationsFromCSV, \r\n  updateDonationInCSV, \r\n  deleteDonationFromCSV,\r\n  generateId,\r\n  DonationCSV \r\n} from \"../utils/csvUtils\";\r\n\r\n// Helper function to convert DonationCSV to Donation\r\nconst csvToApiDonation = (csvDonation: DonationCSV): Donation => ({\r\n  id: csvDonation.id,\r\n  donorId: csvDonation.donorId,\r\n  itemName: csvDonation.itemName,\r\n  category: csvDonation.category as ItemCategory,\r\n  description: csvDonation.description,\r\n  quantity: csvDonation.quantity,\r\n  photoUrl: csvDonation.photoUrl || undefined,\r\n  status: csvDonation.status as 'pending' | 'approved' | 'matched' | 'rejected',\r\n  createdAt: csvDonation.createdAt,\r\n  updatedAt: csvDonation.updatedAt\r\n});\r\n\r\n// Add new donation (POST /api/donations/add) - Donor only\r\nexport const addDonation: RequestHandler = (req: any, res) => {\r\n  try {\r\n    const { itemName, category, description, quantity, photoUrl }: CreateDonationRequest = req.body;\r\n    const userId = req.user?.id;\r\n\r\n    if (!userId) {\r\n      return res.status(401).json({ success: false, message: \"Authentication required.\" });\r\n    }\r\n\r\n    // Validation\r\n    if (!itemName || !category || !description) {\r\n      const response: CreateDonationResponse = {\r\n        success: false,\r\n        message: \"Item name, category, and description are required.\"\r\n      };\r\n      return res.status(400).json(response);\r\n    }\r\n\r\n    if (!['clothes', 'books', 'food', 'furniture', 'electronics', 'toys', 'medical', 'other'].includes(category)) {\r\n      const response: CreateDonationResponse = {\r\n        success: false,\r\n        message: \"Invalid category specified.\"\r\n      };\r\n      return res.status(400).json(response);\r\n    }\r\n\r\n    if (quantity < 1) {\r\n      const response: CreateDonationResponse = {\r\n        success: false,\r\n        message: \"Quantity must be at least 1.\"\r\n      };\r\n      return res.status(400).json(response);\r\n    }\r\n\r\n    // Get donor info\r\n    const donor = findUserById(userId);\r\n    if (!donor) {\r\n      return res.status(404).json({ success: false, message: \"User not found.\" });\r\n    }\r\n\r\n    // Create new donation\r\n    const donationId = generateId();\r\n    const now = new Date().toISOString();\r\n\r\n    const csvDonation: DonationCSV = {\r\n      id: donationId,\r\n      donorId: userId,\r\n      donorName: donor.name,\r\n      donorEmail: donor.email,\r\n      itemName,\r\n      category,\r\n      description,\r\n      quantity: quantity || 1,\r\n      photoUrl: photoUrl || '',\r\n      status: 'pending',\r\n      createdAt: now,\r\n      updatedAt: now\r\n    };\r\n\r\n    // Save to CSV\r\n    saveDonationToCSV(csvDonation);\r\n\r\n    const apiDonation = csvToApiDonation(csvDonation);\r\n\r\n    const response: CreateDonationResponse = {\r\n      success: true,\r\n      message: \"Donation added successfully! It's pending admin approval.\",\r\n      donation: apiDonation\r\n    };\r\n\r\n    res.status(201).json(response);\r\n  } catch (error) {\r\n    console.error(\"Add donation error:\", error);\r\n    const response: CreateDonationResponse = {\r\n      success: false,\r\n      message: \"Internal server error.\"\r\n    };\r\n    res.status(500).json(response);\r\n  }\r\n};\r\n\r\n// Get user's donations (GET /api/donations/my) - Donor only\r\nexport const getMyDonations: RequestHandler = (req: any, res) => {\r\n  try {\r\n    const userId = req.user?.id;\r\n\r\n    if (!userId) {\r\n      return res.status(401).json({ success: false, message: \"Authentication required.\" });\r\n    }\r\n\r\n    const allDonations = readDonationsFromCSV();\r\n    const userDonations = allDonations\r\n      .filter(donation => donation.donorId === userId)\r\n      .map(csvToApiDonation);\r\n\r\n    res.json({\r\n      success: true,\r\n      donations: userDonations\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Get my donations error:\", error);\r\n    res.status(500).json({ success: false, message: \"Internal server error.\" });\r\n  }\r\n};\r\n\r\n// Update donation (PUT /api/donations/:id) - Donor only, before approval\r\nexport const updateDonation: RequestHandler = (req: any, res) => {\r\n  try {\r\n    const { id } = req.params;\r\n    const { itemName, category, description, quantity, photoUrl }: CreateDonationRequest = req.body;\r\n    const userId = req.user?.id;\r\n\r\n    if (!userId) {\r\n      return res.status(401).json({ success: false, message: \"Authentication required.\" });\r\n    }\r\n\r\n    const allDonations = readDonationsFromCSV();\r\n    const donation = allDonations.find(d => d.id === id);\r\n    \r\n    if (!donation) {\r\n      return res.status(404).json({ success: false, message: \"Donation not found.\" });\r\n    }\r\n\r\n    // Check if user owns this donation\r\n    if (donation.donorId !== userId) {\r\n      return res.status(403).json({ success: false, message: \"You can only edit your own donations.\" });\r\n    }\r\n\r\n    // Check if donation can be edited (only pending donations)\r\n    if (donation.status !== 'pending') {\r\n      return res.status(400).json({ \r\n        success: false, \r\n        message: \"You can only edit donations that are still pending approval.\" \r\n      });\r\n    }\r\n\r\n    // Validation\r\n    if (!itemName || !category || !description) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        message: \"Item name, category, and description are required.\"\r\n      });\r\n    }\r\n\r\n    // Update donation in CSV\r\n    const updates: Partial<DonationCSV> = {\r\n      itemName,\r\n      category,\r\n      description,\r\n      quantity: quantity || 1,\r\n      photoUrl: photoUrl || '',\r\n      updatedAt: new Date().toISOString()\r\n    };\r\n\r\n    const success = updateDonationInCSV(id, updates);\r\n    if (!success) {\r\n      return res.status(404).json({ success: false, message: \"Failed to update donation.\" });\r\n    }\r\n\r\n    // Read updated donation\r\n    const updatedDonations = readDonationsFromCSV();\r\n    const updatedDonation = updatedDonations.find(d => d.id === id);\r\n\r\n    res.json({\r\n      success: true,\r\n      message: \"Donation updated successfully.\",\r\n      donation: updatedDonation ? csvToApiDonation(updatedDonation) : null\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Update donation error:\", error);\r\n    res.status(500).json({ success: false, message: \"Internal server error.\" });\r\n  }\r\n};\r\n\r\n// Delete donation (DELETE /api/donations/:id) - Donor only, before approval\r\nexport const deleteDonation: RequestHandler = (req: any, res) => {\r\n  try {\r\n    const { id } = req.params;\r\n    const userId = req.user?.id;\r\n\r\n    if (!userId) {\r\n      return res.status(401).json({ success: false, message: \"Authentication required.\" });\r\n    }\r\n\r\n    const allDonations = readDonationsFromCSV();\r\n    const donation = allDonations.find(d => d.id === id);\r\n    \r\n    if (!donation) {\r\n      return res.status(404).json({ success: false, message: \"Donation not found.\" });\r\n    }\r\n\r\n    // Check if user owns this donation\r\n    if (donation.donorId !== userId) {\r\n      return res.status(403).json({ success: false, message: \"You can only delete your own donations.\" });\r\n    }\r\n\r\n    // Check if donation can be deleted (only pending donations)\r\n    if (donation.status !== 'pending') {\r\n      return res.status(400).json({ \r\n        success: false, \r\n        message: \"You can only delete donations that are still pending approval.\" \r\n      });\r\n    }\r\n\r\n    // Delete from CSV\r\n    const success = deleteDonationFromCSV(id);\r\n    if (!success) {\r\n      return res.status(404).json({ success: false, message: \"Failed to delete donation.\" });\r\n    }\r\n\r\n    res.json({\r\n      success: true,\r\n      message: \"Donation deleted successfully.\"\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Delete donation error:\", error);\r\n    res.status(500).json({ success: false, message: \"Internal server error.\" });\r\n  }\r\n};\r\n\r\n// Get all donations (GET /api/admin/donations) - Admin only\r\nexport const getAllDonations: RequestHandler = (req: any, res) => {\r\n  try {\r\n    const allDonations = readDonationsFromCSV();\r\n    \r\n    const donationsWithDonorInfo = allDonations.map(donation => ({\r\n      ...csvToApiDonation(donation),\r\n      donorName: donation.donorName,\r\n      donorEmail: donation.donorEmail\r\n    }));\r\n\r\n    const response: AdminDonationsResponse = {\r\n      success: true,\r\n      donations: donationsWithDonorInfo\r\n    };\r\n\r\n    res.json(response);\r\n  } catch (error) {\r\n    console.error(\"Get all donations error:\", error);\r\n    res.status(500).json({ success: false, message: \"Internal server error.\" });\r\n  }\r\n};\r\n\r\n// Approve/Reject donation (PUT /api/admin/donations/:id/approve) - Admin only\r\nexport const approveDonation: RequestHandler = (req: any, res) => {\r\n  try {\r\n    const { id } = req.params;\r\n    const { action } = req.body; // 'approve' or 'reject'\r\n\r\n    if (!['approve', 'reject'].includes(action)) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        message: \"Action must be either 'approve' or 'reject'.\"\r\n      });\r\n    }\r\n\r\n    const allDonations = readDonationsFromCSV();\r\n    const donation = allDonations.find(d => d.id === id);\r\n    \r\n    if (!donation) {\r\n      return res.status(404).json({ success: false, message: \"Donation not found.\" });\r\n    }\r\n\r\n    if (donation.status !== 'pending') {\r\n      return res.status(400).json({\r\n        success: false,\r\n        message: \"Only pending donations can be approved or rejected.\"\r\n      });\r\n    }\r\n\r\n    // Update status in CSV\r\n    const updates: Partial<DonationCSV> = {\r\n      status: action === 'approve' ? 'approved' : 'rejected',\r\n      updatedAt: new Date().toISOString()\r\n    };\r\n\r\n    const success = updateDonationInCSV(id, updates);\r\n    if (!success) {\r\n      return res.status(404).json({ success: false, message: \"Failed to update donation status.\" });\r\n    }\r\n\r\n    const response: ApprovalResponse = {\r\n      success: true,\r\n      message: `Donation ${action}d successfully.`\r\n    };\r\n\r\n    res.json(response);\r\n  } catch (error) {\r\n    console.error(\"Approve donation error:\", error);\r\n    res.status(500).json({ success: false, message: \"Internal server error.\" });\r\n  }\r\n};\r\n\r\n// Get approved donations for public use\r\nexport const getApprovedDonations = (): DonationCSV[] => {\r\n  try {\r\n    const allDonations = readDonationsFromCSV();\r\n    return allDonations.filter(donation => donation.status === 'approved');\r\n  } catch (error) {\r\n    console.error(\"Error reading approved donations:\", error);\r\n    return [];\r\n  }\r\n};\r\n","import { RequestHandler } from \"express\";\r\nimport { CreateRequestRequest, CreateRequestResponse, Request, AdminRequestsResponse, ApprovalResponse, ItemCategory } from \"@shared/api\";\r\nimport { findUserById } from \"./auth\";\r\nimport { \r\n  saveRequestToCSV, \r\n  readRequestsFromCSV, \r\n  updateRequestInCSV, \r\n  deleteRequestFromCSV,\r\n  generateId,\r\n  RequestCSV \r\n} from \"../utils/csvUtils\";\r\n\r\n// Helper function to convert RequestCSV to Request\r\nconst csvToApiRequest = (csvRequest: RequestCSV): Request => ({\r\n  id: csvRequest.id,\r\n  receiverId: csvRequest.receiverId,\r\n  itemNeeded: csvRequest.itemNeeded,\r\n  category: csvRequest.category as ItemCategory,\r\n  description: csvRequest.description,\r\n  quantity: csvRequest.quantity,\r\n  urgency: csvRequest.urgency as 'normal' | 'urgent',\r\n  status: csvRequest.status as 'pending' | 'approved' | 'matched' | 'rejected',\r\n  createdAt: csvRequest.createdAt,\r\n  updatedAt: csvRequest.updatedAt\r\n});\r\n\r\n// Add new request (POST /api/requests/add) - Receiver only\r\nexport const addRequest: RequestHandler = (req: any, res) => {\r\n  try {\r\n    const { itemNeeded, category, description, quantity, urgency }: CreateRequestRequest = req.body;\r\n    const userId = req.user?.id;\r\n\r\n    if (!userId) {\r\n      return res.status(401).json({ success: false, message: \"Authentication required.\" });\r\n    }\r\n\r\n    // Validation\r\n    if (!itemNeeded || !category || !description) {\r\n      const response: CreateRequestResponse = {\r\n        success: false,\r\n        message: \"Item needed, category, and description are required.\"\r\n      };\r\n      return res.status(400).json(response);\r\n    }\r\n\r\n    if (!['clothes', 'books', 'food', 'furniture', 'electronics', 'toys', 'medical', 'other'].includes(category)) {\r\n      const response: CreateRequestResponse = {\r\n        success: false,\r\n        message: \"Invalid category specified.\"\r\n      };\r\n      return res.status(400).json(response);\r\n    }\r\n\r\n    if (!['normal', 'urgent'].includes(urgency)) {\r\n      const response: CreateRequestResponse = {\r\n        success: false,\r\n        message: \"Urgency must be either 'normal' or 'urgent'.\"\r\n      };\r\n      return res.status(400).json(response);\r\n    }\r\n\r\n    if (quantity < 1) {\r\n      const response: CreateRequestResponse = {\r\n        success: false,\r\n        message: \"Quantity must be at least 1.\"\r\n      };\r\n      return res.status(400).json(response);\r\n    }\r\n\r\n    // Get receiver info\r\n    const receiver = findUserById(userId);\r\n    if (!receiver) {\r\n      return res.status(404).json({ success: false, message: \"User not found.\" });\r\n    }\r\n\r\n    // Create new request\r\n    const requestId = generateId();\r\n    const now = new Date().toISOString();\r\n\r\n    const csvRequest: RequestCSV = {\r\n      id: requestId,\r\n      receiverId: userId,\r\n      receiverName: receiver.name,\r\n      receiverEmail: receiver.email,\r\n      itemNeeded,\r\n      category,\r\n      description,\r\n      quantity: quantity || 1,\r\n      urgency,\r\n      status: 'pending',\r\n      createdAt: now,\r\n      updatedAt: now\r\n    };\r\n\r\n    // Save to CSV\r\n    saveRequestToCSV(csvRequest);\r\n\r\n    const apiRequest = csvToApiRequest(csvRequest);\r\n\r\n    const response: CreateRequestResponse = {\r\n      success: true,\r\n      message: \"Request posted successfully! It's pending admin approval.\",\r\n      request: apiRequest\r\n    };\r\n\r\n    res.status(201).json(response);\r\n  } catch (error) {\r\n    console.error(\"Add request error:\", error);\r\n    const response: CreateRequestResponse = {\r\n      success: false,\r\n      message: \"Internal server error.\"\r\n    };\r\n    res.status(500).json(response);\r\n  }\r\n};\r\n\r\n// Get user's requests (GET /api/requests/my) - Receiver only\r\nexport const getMyRequests: RequestHandler = (req: any, res) => {\r\n  try {\r\n    const userId = req.user?.id;\r\n\r\n    if (!userId) {\r\n      return res.status(401).json({ success: false, message: \"Authentication required.\" });\r\n    }\r\n\r\n    const allRequests = readRequestsFromCSV();\r\n    const userRequests = allRequests\r\n      .filter(request => request.receiverId === userId)\r\n      .map(csvToApiRequest);\r\n\r\n    res.json({\r\n      success: true,\r\n      requests: userRequests\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Get my requests error:\", error);\r\n    res.status(500).json({ success: false, message: \"Internal server error.\" });\r\n  }\r\n};\r\n\r\n// Update request (PUT /api/requests/:id) - Receiver only, before approval\r\nexport const updateRequest: RequestHandler = (req: any, res) => {\r\n  try {\r\n    const { id } = req.params;\r\n    const { itemNeeded, category, description, quantity, urgency }: CreateRequestRequest = req.body;\r\n    const userId = req.user?.id;\r\n\r\n    if (!userId) {\r\n      return res.status(401).json({ success: false, message: \"Authentication required.\" });\r\n    }\r\n\r\n    const allRequests = readRequestsFromCSV();\r\n    const request = allRequests.find(r => r.id === id);\r\n    \r\n    if (!request) {\r\n      return res.status(404).json({ success: false, message: \"Request not found.\" });\r\n    }\r\n\r\n    // Check if user owns this request\r\n    if (request.receiverId !== userId) {\r\n      return res.status(403).json({ success: false, message: \"You can only edit your own requests.\" });\r\n    }\r\n\r\n    // Check if request can be edited (only pending requests)\r\n    if (request.status !== 'pending') {\r\n      return res.status(400).json({ \r\n        success: false, \r\n        message: \"You can only edit requests that are still pending approval.\" \r\n      });\r\n    }\r\n\r\n    // Validation\r\n    if (!itemNeeded || !category || !description) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        message: \"Item needed, category, and description are required.\"\r\n      });\r\n    }\r\n\r\n    if (!['normal', 'urgent'].includes(urgency)) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        message: \"Urgency must be either 'normal' or 'urgent'.\"\r\n      });\r\n    }\r\n\r\n    // Update request in CSV\r\n    const updates: Partial<RequestCSV> = {\r\n      itemNeeded,\r\n      category,\r\n      description,\r\n      quantity: quantity || 1,\r\n      urgency,\r\n      updatedAt: new Date().toISOString()\r\n    };\r\n\r\n    const success = updateRequestInCSV(id, updates);\r\n    if (!success) {\r\n      return res.status(404).json({ success: false, message: \"Failed to update request.\" });\r\n    }\r\n\r\n    // Read updated request\r\n    const updatedRequests = readRequestsFromCSV();\r\n    const updatedRequest = updatedRequests.find(r => r.id === id);\r\n\r\n    res.json({\r\n      success: true,\r\n      message: \"Request updated successfully.\",\r\n      request: updatedRequest ? csvToApiRequest(updatedRequest) : null\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Update request error:\", error);\r\n    res.status(500).json({ success: false, message: \"Internal server error.\" });\r\n  }\r\n};\r\n\r\n// Delete request (DELETE /api/requests/:id) - Receiver only, before approval\r\nexport const deleteRequest: RequestHandler = (req: any, res) => {\r\n  try {\r\n    const { id } = req.params;\r\n    const userId = req.user?.id;\r\n\r\n    if (!userId) {\r\n      return res.status(401).json({ success: false, message: \"Authentication required.\" });\r\n    }\r\n\r\n    const allRequests = readRequestsFromCSV();\r\n    const request = allRequests.find(r => r.id === id);\r\n    \r\n    if (!request) {\r\n      return res.status(404).json({ success: false, message: \"Request not found.\" });\r\n    }\r\n\r\n    // Check if user owns this request\r\n    if (request.receiverId !== userId) {\r\n      return res.status(403).json({ success: false, message: \"You can only delete your own requests.\" });\r\n    }\r\n\r\n    // Check if request can be deleted (only pending requests)\r\n    if (request.status !== 'pending') {\r\n      return res.status(400).json({ \r\n        success: false, \r\n        message: \"You can only delete requests that are still pending approval.\" \r\n      });\r\n    }\r\n\r\n    // Delete from CSV\r\n    const success = deleteRequestFromCSV(id);\r\n    if (!success) {\r\n      return res.status(404).json({ success: false, message: \"Failed to delete request.\" });\r\n    }\r\n\r\n    res.json({\r\n      success: true,\r\n      message: \"Request deleted successfully.\"\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Delete request error:\", error);\r\n    res.status(500).json({ success: false, message: \"Internal server error.\" });\r\n  }\r\n};\r\n\r\n// Get all requests (GET /api/admin/requests) - Admin only\r\nexport const getAllRequests: RequestHandler = (req: any, res) => {\r\n  try {\r\n    const allRequests = readRequestsFromCSV();\r\n    \r\n    const requestsWithReceiverInfo = allRequests.map(request => ({\r\n      ...csvToApiRequest(request),\r\n      receiverName: request.receiverName,\r\n      receiverEmail: request.receiverEmail\r\n    }));\r\n\r\n    const response: AdminRequestsResponse = {\r\n      success: true,\r\n      requests: requestsWithReceiverInfo\r\n    };\r\n\r\n    res.json(response);\r\n  } catch (error) {\r\n    console.error(\"Get all requests error:\", error);\r\n    res.status(500).json({ success: false, message: \"Internal server error.\" });\r\n  }\r\n};\r\n\r\n// Approve/Reject request (PUT /api/admin/requests/:id/approve) - Admin only\r\nexport const approveRequest: RequestHandler = (req: any, res) => {\r\n  try {\r\n    const { id } = req.params;\r\n    const { action } = req.body; // 'approve' or 'reject'\r\n\r\n    if (!['approve', 'reject'].includes(action)) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        message: \"Action must be either 'approve' or 'reject'.\"\r\n      });\r\n    }\r\n\r\n    const allRequests = readRequestsFromCSV();\r\n    const request = allRequests.find(r => r.id === id);\r\n    \r\n    if (!request) {\r\n      return res.status(404).json({ success: false, message: \"Request not found.\" });\r\n    }\r\n\r\n    if (request.status !== 'pending') {\r\n      return res.status(400).json({\r\n        success: false,\r\n        message: \"Only pending requests can be approved or rejected.\"\r\n      });\r\n    }\r\n\r\n    // Update status in CSV\r\n    const updates: Partial<RequestCSV> = {\r\n      status: action === 'approve' ? 'approved' : 'rejected',\r\n      updatedAt: new Date().toISOString()\r\n    };\r\n\r\n    const success = updateRequestInCSV(id, updates);\r\n    if (!success) {\r\n      return res.status(404).json({ success: false, message: \"Failed to update request status.\" });\r\n    }\r\n\r\n    const response: ApprovalResponse = {\r\n      success: true,\r\n      message: `Request ${action}d successfully.`\r\n    };\r\n\r\n    res.json(response);\r\n  } catch (error) {\r\n    console.error(\"Approve request error:\", error);\r\n    res.status(500).json({ success: false, message: \"Internal server error.\" });\r\n  }\r\n};\r\n\r\n// Get public requests (GET /api/public/requests) - No authentication required\r\nexport const getPublicRequests: RequestHandler = (req: any, res) => {\r\n  try {\r\n    const allRequests = readRequestsFromCSV();\r\n    \r\n    // Only return approved requests\r\n    const publicRequests = allRequests\r\n      .filter(request => request.status === 'approved')\r\n      .map(request => ({\r\n        ...csvToApiRequest(request),\r\n        receiverName: request.receiverName || 'Anonymous',\r\n        receiverEmail: request.receiverEmail || 'Hidden'\r\n      }))\r\n      .sort((a, b) => {\r\n        // Sort by urgency first (urgent first), then by creation date (newest first)\r\n        if (a.urgency === 'urgent' && b.urgency !== 'urgent') return -1;\r\n        if (b.urgency === 'urgent' && a.urgency !== 'urgent') return 1;\r\n        return new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime();\r\n      });\r\n\r\n    res.json({\r\n      success: true,\r\n      requests: publicRequests\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Get public requests error:\", error);\r\n    res.status(500).json({ success: false, message: \"Internal server error.\" });\r\n  }\r\n};\r\n\r\n// Get approved requests for public use\r\nexport const getApprovedRequests = (): RequestCSV[] => {\r\n  try {\r\n    const allRequests = readRequestsFromCSV();\r\n    return allRequests.filter(request => request.status === 'approved');\r\n  } catch (error) {\r\n    console.error(\"Error reading approved requests:\", error);\r\n    return [];\r\n  }\r\n};\r\n","import { RequestHandler } from \"express\";\r\nimport { CreateMatchRequest, CreateMatchResponse, Match } from \"@shared/api\";\r\nimport { readDonationsFromCSV, readRequestsFromCSV, updateDonationInCSV, updateRequestInCSV } from \"../utils/csvUtils\";\r\nimport crypto from \"crypto\";\r\n\r\n// Simple in-memory storage for matches (could also be moved to CSV if needed)\r\nconst matches: Match[] = [];\r\n\r\n// Create match (POST /api/admin/match) - Admin only\r\nexport const createMatch: RequestHandler = (req: any, res) => {\r\n  try {\r\n    const { donationId, requestId }: CreateMatchRequest = req.body;\r\n\r\n    // Validation\r\n    if (!donationId || !requestId) {\r\n      const response: CreateMatchResponse = {\r\n        success: false,\r\n        message: \"Both donation ID and request ID are required.\"\r\n      };\r\n      return res.status(400).json(response);\r\n    }\r\n\r\n    // Read current data from CSV files\r\n    const donations = readDonationsFromCSV();\r\n    const requests = readRequestsFromCSV();\r\n\r\n    // Find donation\r\n    const donation = donations.find(d => d.id === donationId);\r\n    if (!donation) {\r\n      const response: CreateMatchResponse = {\r\n        success: false,\r\n        message: \"Donation not found.\"\r\n      };\r\n      return res.status(404).json(response);\r\n    }\r\n\r\n    // Find request\r\n    const request = requests.find(r => r.id === requestId);\r\n    if (!request) {\r\n      const response: CreateMatchResponse = {\r\n        success: false,\r\n        message: \"Request not found.\"\r\n      };\r\n      return res.status(404).json(response);\r\n    }\r\n\r\n    // Check if donation is approved\r\n    if (donation.status !== 'approved') {\r\n      const response: CreateMatchResponse = {\r\n        success: false,\r\n        message: \"Only approved donations can be matched.\"\r\n      };\r\n      return res.status(400).json(response);\r\n    }\r\n\r\n    // Check if request is approved\r\n    if (request.status !== 'approved') {\r\n      const response: CreateMatchResponse = {\r\n        success: false,\r\n        message: \"Only approved requests can be matched.\"\r\n      };\r\n      return res.status(400).json(response);\r\n    }\r\n\r\n    // Check if donation is already matched\r\n    if (donation.status === 'matched') {\r\n      const response: CreateMatchResponse = {\r\n        success: false,\r\n        message: \"This donation has already been matched.\"\r\n      };\r\n      return res.status(400).json(response);\r\n    }\r\n\r\n    // Check if request is already matched\r\n    if (request.status === 'matched') {\r\n      const response: CreateMatchResponse = {\r\n        success: false,\r\n        message: \"This request has already been matched.\"\r\n      };\r\n      return res.status(400).json(response);\r\n    }\r\n\r\n    // Optional: Check if categories match (warning, not error)\r\n    if (donation.category !== request.category) {\r\n      console.warn(`Category mismatch: Donation (${donation.category}) and Request (${request.category})`);\r\n    }\r\n\r\n    // Create match\r\n    const matchId = crypto.randomUUID();\r\n    const now = new Date().toISOString();\r\n\r\n    const newMatch: Match = {\r\n      id: matchId,\r\n      donationId,\r\n      requestId,\r\n      status: 'active',\r\n      createdAt: now,\r\n      updatedAt: now\r\n    };\r\n\r\n    matches.push(newMatch);\r\n\r\n    // Update donation and request status to 'matched' in CSV files\r\n    updateDonationInCSV(donationId, { status: 'matched', updatedAt: now });\r\n    updateRequestInCSV(requestId, { status: 'matched', updatedAt: now });\r\n\r\n    const response: CreateMatchResponse = {\r\n      success: true,\r\n      message: \"Donation and request matched successfully!\",\r\n      match: newMatch\r\n    };\r\n\r\n    res.status(201).json(response);\r\n  } catch (error) {\r\n    console.error(\"Create match error:\", error);\r\n    const response: CreateMatchResponse = {\r\n      success: false,\r\n      message: \"Internal server error.\"\r\n    };\r\n    res.status(500).json(response);\r\n  }\r\n};\r\n\r\n// Get all matches (GET /api/admin/matches) - Admin only\r\nexport const getAllMatches: RequestHandler = (req: any, res) => {\r\n  try {\r\n    // Read current data from CSV files\r\n    const donations = readDonationsFromCSV();\r\n    const requests = readRequestsFromCSV();\r\n\r\n    // Enhanced matches with donation and request details\r\n    const enhancedMatches = matches.map(match => {\r\n      const donation = donations.find(d => d.id === match.donationId);\r\n      const request = requests.find(r => r.id === match.requestId);\r\n      \r\n      return {\r\n        ...match,\r\n        donation: donation ? {\r\n          itemName: donation.itemName,\r\n          category: donation.category,\r\n          donorName: donation.donorName\r\n        } : null,\r\n        request: request ? {\r\n          itemNeeded: request.itemNeeded,\r\n          category: request.category,\r\n          receiverName: request.receiverName\r\n        } : null\r\n      };\r\n    });\r\n\r\n    res.json({\r\n      success: true,\r\n      matches: enhancedMatches\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Get all matches error:\", error);\r\n    res.status(500).json({ success: false, message: \"Internal server error.\" });\r\n  }\r\n};\r\n\r\n// Complete match (PUT /api/admin/matches/:id/complete) - Admin only\r\nexport const completeMatch: RequestHandler = (req: any, res) => {\r\n  try {\r\n    const { id } = req.params;\r\n\r\n    const match = matches.find(m => m.id === id);\r\n    if (!match) {\r\n      return res.status(404).json({ success: false, message: \"Match not found.\" });\r\n    }\r\n\r\n    if (match.status !== 'active') {\r\n      return res.status(400).json({\r\n        success: false,\r\n        message: \"Only active matches can be completed.\"\r\n      });\r\n    }\r\n\r\n    // Update match status\r\n    match.status = 'completed';\r\n    match.updatedAt = new Date().toISOString();\r\n\r\n    res.json({\r\n      success: true,\r\n      message: \"Match completed successfully.\",\r\n      match\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Complete match error:\", error);\r\n    res.status(500).json({ success: false, message: \"Internal server error.\" });\r\n  }\r\n};\r\n\r\n// Cancel match (PUT /api/admin/matches/:id/cancel) - Admin only\r\nexport const cancelMatch: RequestHandler = (req: any, res) => {\r\n  try {\r\n    const { id } = req.params;\r\n\r\n    const match = matches.find(m => m.id === id);\r\n    if (!match) {\r\n      return res.status(404).json({ success: false, message: \"Match not found.\" });\r\n    }\r\n\r\n    if (match.status !== 'active') {\r\n      return res.status(400).json({\r\n        success: false,\r\n        message: \"Only active matches can be cancelled.\"\r\n      });\r\n    }\r\n\r\n    const now = new Date().toISOString();\r\n\r\n    // Reset donation and request status to 'approved' in CSV files\r\n    updateDonationInCSV(match.donationId, { status: 'approved', updatedAt: now });\r\n    updateRequestInCSV(match.requestId, { status: 'approved', updatedAt: now });\r\n\r\n    // Update match status\r\n    match.status = 'cancelled';\r\n    match.updatedAt = now;\r\n\r\n    res.json({\r\n      success: true,\r\n      message: \"Match cancelled successfully. Donation and request are now available for new matches.\",\r\n      match\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Cancel match error:\", error);\r\n    res.status(500).json({ success: false, message: \"Internal server error.\" });\r\n  }\r\n};\r\n\r\n// Export matches for potential future use\r\nexport { matches };\r\n","import { RequestHandler } from \"express\";\r\nimport { readDonationsFromCSV, readRequestsFromCSV } from \"../utils/csvUtils\";\r\n\r\ninterface DonationActivity {\r\n  id: string;\r\n  type: 'donation' | 'request';\r\n  userName: string;\r\n  itemName: string;\r\n  quantity: string;\r\n  location: string;\r\n  timestamp: string;\r\n}\r\n\r\n// Get public activities with sample data (GET /api/public/activities) - No authentication required\r\nexport const getPublicActivitiesWithSample: RequestHandler = (req: any, res) => {\r\n  try {\r\n    const activities: DonationActivity[] = [];\r\n    \r\n    // Read donations from CSV\r\n    const donations = readDonationsFromCSV();\r\n    const approvedDonations = donations.filter(d => d.status === 'approved');\r\n    \r\n    // Read requests from CSV\r\n    const requests = readRequestsFromCSV();\r\n    const approvedRequests = requests.filter(r => r.status === 'approved');\r\n    \r\n    // Convert donations to activities\r\n    approvedDonations.forEach(donation => {\r\n      activities.push({\r\n        id: donation.id,\r\n        type: 'donation',\r\n        userName: donation.donorName,\r\n        itemName: donation.itemName,\r\n        quantity: donation.quantity.toString(),\r\n        location: 'Local Community', // Could be enhanced with actual location data\r\n        timestamp: donation.createdAt\r\n      });\r\n    });\r\n    \r\n    // Convert requests to activities\r\n    approvedRequests.forEach(request => {\r\n      activities.push({\r\n        id: request.id,\r\n        type: 'request',\r\n        userName: request.receiverName,\r\n        itemName: request.itemNeeded,\r\n        quantity: request.quantity.toString(),\r\n        location: 'Local Community', // Could be enhanced with actual location data\r\n        timestamp: request.createdAt\r\n      });\r\n    });\r\n    \r\n    // Sort by timestamp (newest first) and limit to recent activities\r\n    activities.sort((a, b) => new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime());\r\n    const recentActivities = activities.slice(0, 20); // Show last 20 activities\r\n    \r\n    res.json({\r\n      success: true,\r\n      activities: recentActivities\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Get public activities error:\", error);\r\n    res.status(500).json({ \r\n      success: false, \r\n      message: \"Internal server error.\",\r\n      activities: []\r\n    });\r\n  }\r\n};\r\n","import { RequestHandler } from \"express\";\r\nimport { readDonationsFromCSV, readRequestsFromCSV, DonationCSV, RequestCSV } from \"../utils/csvUtils\";\r\n\r\n// Get public donations (GET /api/public/donations) - No authentication required\r\nexport const getPublicDonations: RequestHandler = (req: any, res) => {\r\n  try {\r\n    const allDonations = readDonationsFromCSV();\r\n    \r\n    // Only return approved donations\r\n    const publicDonations = allDonations\r\n      .filter(donation => donation.status === 'approved')\r\n      .map(donation => ({\r\n        id: donation.id,\r\n        donorName: donation.donorName,\r\n        itemName: donation.itemName,\r\n        category: donation.category,\r\n        description: donation.description,\r\n        quantity: donation.quantity,\r\n        photoUrl: donation.photoUrl || undefined,\r\n        createdAt: donation.createdAt,\r\n        updatedAt: donation.updatedAt\r\n      }))\r\n      .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\r\n\r\n    res.json({\r\n      success: true,\r\n      donations: publicDonations\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Get public donations error:\", error);\r\n    res.status(500).json({ \r\n      success: false, \r\n      message: \"Internal server error.\",\r\n      donations: []\r\n    });\r\n  }\r\n};\r\n\r\n// Search donations and requests (GET /api/public/search) - No authentication required\r\nexport const searchPublicData: RequestHandler = (req: any, res) => {\r\n  try {\r\n    const {\r\n      itemName = '',\r\n      category = 'all',\r\n      minQuantity = '1',\r\n      maxQuantity = '100',\r\n      urgency = 'all',\r\n      type = 'both'\r\n    } = req.query;\r\n\r\n    let donations: any[] = [];\r\n    let requests: any[] = [];\r\n\r\n    // Read donations if requested\r\n    if (type === 'donations' || type === 'both') {\r\n      const allDonations = readDonationsFromCSV();\r\n      donations = allDonations\r\n        .filter(donation => donation.status === 'approved')\r\n        .filter(donation => {\r\n          // Filter by category\r\n          if (category !== 'all' && donation.category !== category) return false;\r\n          \r\n          // Filter by item name\r\n          if (itemName && !donation.itemName.toLowerCase().includes(itemName.toLowerCase())) return false;\r\n          \r\n          // Filter by quantity range\r\n          const min = parseInt(minQuantity as string) || 1;\r\n          const max = parseInt(maxQuantity as string) || 100;\r\n          if (donation.quantity < min || donation.quantity > max) return false;\r\n          \r\n          return true;\r\n        })\r\n        .map(donation => ({\r\n          id: donation.id,\r\n          donorName: donation.donorName,\r\n          itemName: donation.itemName,\r\n          category: donation.category,\r\n          description: donation.description,\r\n          quantity: donation.quantity,\r\n          photoUrl: donation.photoUrl || undefined,\r\n          createdAt: donation.createdAt,\r\n          updatedAt: donation.updatedAt\r\n        }));\r\n    }\r\n\r\n    // Read requests if requested\r\n    if (type === 'requests' || type === 'both') {\r\n      const allRequests = readRequestsFromCSV();\r\n      requests = allRequests\r\n        .filter(request => request.status === 'approved')\r\n        .filter(request => {\r\n          // Filter by category\r\n          if (category !== 'all' && request.category !== category) return false;\r\n          \r\n          // Filter by item name\r\n          if (itemName && !request.itemNeeded.toLowerCase().includes(itemName.toLowerCase())) return false;\r\n          \r\n          // Filter by quantity range\r\n          const min = parseInt(minQuantity as string) || 1;\r\n          const max = parseInt(maxQuantity as string) || 100;\r\n          if (request.quantity < min || request.quantity > max) return false;\r\n          \r\n          // Filter by urgency\r\n          if (urgency !== 'all' && request.urgency !== urgency) return false;\r\n          \r\n          return true;\r\n        })\r\n        .map(request => ({\r\n          id: request.id,\r\n          receiverName: request.receiverName,\r\n          itemNeeded: request.itemNeeded,\r\n          category: request.category,\r\n          description: request.description,\r\n          quantity: request.quantity,\r\n          urgency: request.urgency,\r\n          createdAt: request.createdAt,\r\n          updatedAt: request.updatedAt\r\n        }));\r\n    }\r\n\r\n    // Sort by relevance (can be enhanced with more sophisticated scoring)\r\n    const sortByRelevance = (items: any[], searchTerm: string) => {\r\n      return items.sort((a, b) => {\r\n        const aName = 'itemName' in a ? a.itemName : a.itemNeeded;\r\n        const bName = 'itemName' in b ? b.itemName : b.itemNeeded;\r\n        \r\n        // Exact match gets highest score\r\n        const aExact = aName.toLowerCase() === searchTerm.toLowerCase() ? 100 : 0;\r\n        const bExact = bName.toLowerCase() === searchTerm.toLowerCase() ? 100 : 0;\r\n        \r\n        // Partial match gets medium score\r\n        const aPartial = aName.toLowerCase().includes(searchTerm.toLowerCase()) ? 50 : 0;\r\n        const bPartial = bName.toLowerCase().includes(searchTerm.toLowerCase()) ? 50 : 0;\r\n        \r\n        // Urgency bonus for requests\r\n        const aUrgency = ('urgency' in a && a.urgency === 'urgent') ? 30 : 0;\r\n        const bUrgency = ('urgency' in b && b.urgency === 'urgent') ? 30 : 0;\r\n        \r\n        // Recent items bonus\r\n        const aDays = (Date.now() - new Date(a.createdAt).getTime()) / (1000 * 60 * 60 * 24);\r\n        const bDays = (Date.now() - new Date(b.createdAt).getTime()) / (1000 * 60 * 60 * 24);\r\n        const aRecent = Math.max(0, 20 - aDays);\r\n        const bRecent = Math.max(0, 20 - bDays);\r\n        \r\n        const aScore = aExact + aPartial + aUrgency + aRecent;\r\n        const bScore = bExact + bPartial + bUrgency + bRecent;\r\n        \r\n        return bScore - aScore;\r\n      });\r\n    };\r\n\r\n    if (itemName) {\r\n      donations = sortByRelevance(donations, itemName as string);\r\n      requests = sortByRelevance(requests, itemName as string);\r\n    } else {\r\n      // Default sort by creation date (newest first)\r\n      donations.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\r\n      requests.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\r\n    }\r\n\r\n    res.json({\r\n      success: true,\r\n      donations,\r\n      requests\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Search public data error:\", error);\r\n    res.status(500).json({ \r\n      success: false, \r\n      message: \"Internal server error.\",\r\n      donations: [],\r\n      requests: []\r\n    });\r\n  }\r\n};\r\n","import { RequestHandler } from \"express\";\r\nimport { saveDonationToCSV, saveRequestToCSV, generateId, DonationCSV, RequestCSV } from \"../utils/csvUtils\";\r\n\r\n// Seed test data (POST /api/seed) - For testing purposes\r\nexport const seedTestData: RequestHandler = (req: any, res) => {\r\n  try {\r\n    const now = new Date().toISOString();\r\n    \r\n    // Sample donations\r\n    const sampleDonations: DonationCSV[] = [\r\n      {\r\n        id: generateId(),\r\n        donorId: 'donor1',\r\n        donorName: 'John Doe',\r\n        donorEmail: 'john@example.com',\r\n        itemName: 'Winter Clothes',\r\n        category: 'clothes',\r\n        description: 'Warm winter jackets, sweaters, and pants for children ages 5-12',\r\n        quantity: 20,\r\n        photoUrl: '',\r\n        status: 'approved',\r\n        createdAt: now,\r\n        updatedAt: now\r\n      },\r\n      {\r\n        id: generateId(),\r\n        donorId: 'donor2',\r\n        donorName: 'Jane Smith',\r\n        donorEmail: 'jane@example.com',\r\n        itemName: 'Rice and Lentils',\r\n        category: 'food',\r\n        description: '50kg of rice and 20kg of lentils for families in need',\r\n        quantity: 70,\r\n        photoUrl: '',\r\n        status: 'approved',\r\n        createdAt: new Date(Date.now() - 86400000).toISOString(),\r\n        updatedAt: new Date(Date.now() - 86400000).toISOString()\r\n      },\r\n      {\r\n        id: generateId(),\r\n        donorId: 'donor3',\r\n        donorName: 'Medical Center',\r\n        donorEmail: 'medical@example.com',\r\n        itemName: 'Medical Supplies',\r\n        category: 'medical',\r\n        description: 'First aid kits, bandages, and basic medicines',\r\n        quantity: 15,\r\n        photoUrl: '',\r\n        status: 'approved',\r\n        createdAt: new Date(Date.now() - 172800000).toISOString(),\r\n        updatedAt: new Date(Date.now() - 172800000).toISOString()\r\n      },\r\n      {\r\n        id: generateId(),\r\n        donorId: 'donor4',\r\n        donorName: 'Tech Company',\r\n        donorEmail: 'tech@example.com',\r\n        itemName: 'Laptops',\r\n        category: 'electronics',\r\n        description: 'Refurbished laptops for students and educational purposes',\r\n        quantity: 5,\r\n        photoUrl: '',\r\n        status: 'approved',\r\n        createdAt: new Date(Date.now() - 259200000).toISOString(),\r\n        updatedAt: new Date(Date.now() - 259200000).toISOString()\r\n      },\r\n      {\r\n        id: generateId(),\r\n        donorId: 'donor5',\r\n        donorName: 'Book Lover',\r\n        donorEmail: 'books@example.com',\r\n        itemName: 'Educational Books',\r\n        category: 'books',\r\n        description: 'Textbooks and reference books for high school students',\r\n        quantity: 50,\r\n        photoUrl: '',\r\n        status: 'approved',\r\n        createdAt: new Date(Date.now() - 345600000).toISOString(),\r\n        updatedAt: new Date(Date.now() - 345600000).toISOString()\r\n      }\r\n    ];\r\n\r\n    // Sample requests\r\n    const sampleRequests: RequestCSV[] = [\r\n      {\r\n        id: generateId(),\r\n        receiverId: 'receiver1',\r\n        receiverName: 'Maria Garcia',\r\n        receiverEmail: 'maria@example.com',\r\n        itemNeeded: 'School Supplies',\r\n        category: 'books',\r\n        description: 'Notebooks, pens, pencils for 3 children starting school',\r\n        quantity: 30,\r\n        urgency: 'urgent',\r\n        status: 'approved',\r\n        createdAt: now,\r\n        updatedAt: now\r\n      },\r\n      {\r\n        id: generateId(),\r\n        receiverId: 'receiver2',\r\n        receiverName: 'Ahmed Ali',\r\n        receiverEmail: 'ahmed@example.com',\r\n        itemNeeded: 'Baby Formula',\r\n        category: 'food',\r\n        description: 'Infant formula for 6-month-old baby - lactose-free if possible',\r\n        quantity: 10,\r\n        urgency: 'urgent',\r\n        status: 'approved',\r\n        createdAt: new Date(Date.now() - 43200000).toISOString(),\r\n        updatedAt: new Date(Date.now() - 43200000).toISOString()\r\n      },\r\n      {\r\n        id: generateId(),\r\n        receiverId: 'receiver3',\r\n        receiverName: 'Chen Wei',\r\n        receiverEmail: 'chen@example.com',\r\n        itemNeeded: 'Blankets',\r\n        category: 'clothes',\r\n        description: 'Warm blankets for elderly family members during winter',\r\n        quantity: 5,\r\n        urgency: 'normal',\r\n        status: 'approved',\r\n        createdAt: new Date(Date.now() - 129600000).toISOString(),\r\n        updatedAt: new Date(Date.now() - 129600000).toISOString()\r\n      },\r\n      {\r\n        id: generateId(),\r\n        receiverId: 'receiver4',\r\n        receiverName: 'Local Clinic',\r\n        receiverEmail: 'clinic@example.com',\r\n        itemNeeded: 'Blood Pressure Monitor',\r\n        category: 'medical',\r\n        description: 'Digital blood pressure monitor for community health checks',\r\n        quantity: 2,\r\n        urgency: 'normal',\r\n        status: 'approved',\r\n        createdAt: new Date(Date.now() - 216000000).toISOString(),\r\n        updatedAt: new Date(Date.now() - 216000000).toISOString()\r\n      },\r\n      {\r\n        id: generateId(),\r\n        receiverId: 'receiver5',\r\n        receiverName: 'Single Parent',\r\n        receiverEmail: 'parent@example.com',\r\n        itemNeeded: 'Children Toys',\r\n        category: 'toys',\r\n        description: 'Educational toys for 2 children ages 3 and 5',\r\n        quantity: 8,\r\n        urgency: 'normal',\r\n        status: 'approved',\r\n        createdAt: new Date(Date.now() - 302400000).toISOString(),\r\n        updatedAt: new Date(Date.now() - 302400000).toISOString()\r\n      }\r\n    ];\r\n\r\n    // Save sample data to CSV files\r\n    sampleDonations.forEach(donation => {\r\n      saveDonationToCSV(donation);\r\n    });\r\n\r\n    sampleRequests.forEach(request => {\r\n      saveRequestToCSV(request);\r\n    });\r\n\r\n    res.json({\r\n      success: true,\r\n      message: `Seeded ${sampleDonations.length} donations and ${sampleRequests.length} requests to CSV files.`,\r\n      data: {\r\n        donations: sampleDonations.length,\r\n        requests: sampleRequests.length\r\n      }\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Seed data error:\", error);\r\n    res.status(500).json({ \r\n      success: false, \r\n      message: \"Failed to seed test data.\" \r\n    });\r\n  }\r\n};\r\n","import \"dotenv/config\";\r\nimport express from \"express\";\r\nimport cors from \"cors\";\r\nimport { handleDemo } from \"./routes/demo\";\r\nimport { handleRegister, handleLogin, authenticateToken, requireRole } from \"./routes/auth\";\r\nimport { addDonation, getMyDonations, updateDonation, deleteDonation, getAllDonations, approveDonation } from \"./routes/donations\";\r\nimport { addRequest, getMyRequests, updateRequest, deleteRequest, getAllRequests, approveRequest, getPublicRequests } from \"./routes/requests\";\r\nimport { createMatch, getAllMatches, completeMatch, cancelMatch } from \"./routes/matching\";\r\nimport { getPublicActivitiesWithSample } from \"./routes/activities\";\r\nimport { getPublicDonations, searchPublicData } from \"./routes/public\";\r\nimport { seedTestData } from \"./routes/seed\";\r\nimport { initializeCSVFiles } from \"./utils/csvUtils\";\r\n\r\nexport function createServer() {\r\n  const app = express();\r\n\r\n  // Initialize CSV files on server startup\r\n  initializeCSVFiles();\r\n\r\n  // Middleware\r\n  app.use(cors());\r\n  app.use(express.json());\r\n  app.use(express.urlencoded({ extended: true }));\r\n\r\n  // Public routes (no authentication required)\r\n  app.get(\"/api/public/requests\", getPublicRequests);\r\n  app.get(\"/api/public/donations\", getPublicDonations);\r\n  app.get(\"/api/public/search\", searchPublicData);\r\n  app.get(\"/api/public/activities\", getPublicActivitiesWithSample);\r\n\r\n  // Authentication routes\r\n  app.post(\"/api/register\", handleRegister);\r\n  app.post(\"/api/login\", handleLogin);\r\n\r\n  // Donation routes\r\n  app.post(\"/api/donations/add\", authenticateToken, requireRole(['donor']), addDonation);\r\n  app.get(\"/api/donations/my\", authenticateToken, requireRole(['donor']), getMyDonations);\r\n  app.put(\"/api/donations/:id\", authenticateToken, requireRole(['donor']), updateDonation);\r\n  app.delete(\"/api/donations/:id\", authenticateToken, requireRole(['donor']), deleteDonation);\r\n\r\n  // Request routes\r\n  app.post(\"/api/requests/add\", authenticateToken, requireRole(['receiver']), addRequest);\r\n  app.get(\"/api/requests/my\", authenticateToken, requireRole(['receiver']), getMyRequests);\r\n  app.put(\"/api/requests/:id\", authenticateToken, requireRole(['receiver']), updateRequest);\r\n  app.delete(\"/api/requests/:id\", authenticateToken, requireRole(['receiver']), deleteRequest);\r\n\r\n  // Admin donation routes\r\n  app.get(\"/api/admin/donations\", authenticateToken, requireRole(['admin']), getAllDonations);\r\n  app.put(\"/api/admin/donations/:id/approve\", authenticateToken, requireRole(['admin']), approveDonation);\r\n\r\n  // Admin request routes\r\n  app.get(\"/api/admin/requests\", authenticateToken, requireRole(['admin']), getAllRequests);\r\n  app.put(\"/api/admin/requests/:id/approve\", authenticateToken, requireRole(['admin']), approveRequest);\r\n\r\n  // Admin matching routes\r\n  app.post(\"/api/admin/match\", authenticateToken, requireRole(['admin']), createMatch);\r\n  app.get(\"/api/admin/matches\", authenticateToken, requireRole(['admin']), getAllMatches);\r\n  app.put(\"/api/admin/matches/:id/complete\", authenticateToken, requireRole(['admin']), completeMatch);\r\n  app.put(\"/api/admin/matches/:id/cancel\", authenticateToken, requireRole(['admin']), cancelMatch);\r\n\r\n  // Example API routes\r\n  app.get(\"/api/ping\", (_req, res) => {\r\n    const ping = process.env.PING_MESSAGE ?? \"ping\";\r\n    res.json({ message: ping });\r\n  });\r\n\r\n  app.get(\"/api/demo\", handleDemo);\r\n\r\n  // Development/Testing route - remove in production\r\n  app.post(\"/api/seed\", seedTestData);\r\n\r\n  return app;\r\n}\r\n","import path from \"path\";\r\nimport { createServer } from \"./index\";\r\nimport * as express from \"express\";\r\n\r\nconst app = createServer();\r\nconst port = process.env.PORT || 3000;\r\n\r\n// In production, serve the built SPA files\r\nconst __dirname = import.meta.dirname;\r\nconst distPath = path.join(__dirname, \"../spa\");\r\n\r\n// Serve static files\r\napp.use(express.static(distPath));\r\n\r\n// Handle React Router - serve index.html for all non-API routes\r\napp.get(\"*\", (req, res) => {\r\n  // Don't serve index.html for API routes\r\n  if (req.path.startsWith(\"/api/\") || req.path.startsWith(\"/health\")) {\r\n    return res.status(404).json({ error: \"API endpoint not found\" });\r\n  }\r\n\r\n  res.sendFile(path.join(distPath, \"index.html\"));\r\n});\r\n\r\napp.listen(port, () => {\r\n  console.log(` Fusion Starter server running on port ${port}`);\r\n  console.log(` Frontend: http://localhost:${port}`);\r\n  console.log(` API: http://localhost:${port}/api`);\r\n});\r\n\r\n// Graceful shutdown\r\nprocess.on(\"SIGTERM\", () => {\r\n  console.log(\" Received SIGTERM, shutting down gracefully\");\r\n  process.exit(0);\r\n});\r\n\r\nprocess.on(\"SIGINT\", () => {\r\n  console.log(\" Received SIGINT, shutting down gracefully\");\r\n  process.exit(0);\r\n});\r\n"],"names":["response","app","express"],"mappings":"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"}